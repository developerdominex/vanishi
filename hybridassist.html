<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hybrid Assit</title>
<link rel="icon" type="image/png" href="hybrid.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --accent:#6366f1;
  --accent-hover:#4f46e5;
  --bg:#f9fafb;
  --card:#ffffff;
  --muted:#6b7280;
  --text:#111827;
  --shadow:rgba(0,0,0,0.06);
  --bot:#f3f4f6;
  --user:#eef2ff;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,sans-serif;}
body{height:100vh;background:var(--bg);color:var(--text);display:flex;flex-direction:column;}

#titlebar {
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;
  background:var(--accent);
  color:#fff;
  font-weight:600;
  font-size:16px;
  position:fixed;top:0;left:0;width:100%;z-index:10;
  border-bottom:1px solid rgba(255,255,255,0.2);
}
#titlebar i{margin-right:8px;}

.wrap {
  display:flex;flex-direction:column;
  flex:1;
  padding-top:60px;   /* header height */
  padding-bottom:90px; /* input bar height */
  overflow:hidden;
}

#chat-area {
  flex:1;
  overflow-y:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
  scroll-behavior:smooth;
}

.bubble{
  max-width:80%;
  padding:14px 16px;
  border-radius:16px;
  line-height:1.5;
  font-size:14px;
  word-break:break-word;
  white-space:pre-wrap;
  box-shadow:0 4px 12px var(--shadow);
  animation:fadeIn .2s ease-out;
}
.user{
  margin-left:auto;
  background:var(--user);
  color:var(--text);
  border-bottom-right-radius:4px;
}
.bot{
  margin-right:auto;
  background:var(--bot);
  color:var(--text);
  border-bottom-left-radius:4px;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(6px);}
  to{opacity:1;transform:none;}
}

.typing{display:inline-block;width:46px;height:14px;position:relative;}
.typing span{position:absolute;width:8px;height:8px;background:var(--accent);border-radius:50%;animation:blink 1s infinite;bottom:0;}
.typing span:nth-child(2){left:12px;animation-delay:.12s;}
.typing span:nth-child(3){left:24px;animation-delay:.24s;}
@keyframes blink{0%{transform:translateY(0);opacity:.25}50%{transform:translateY(-6px);opacity:1}100%{transform:translateY(0);opacity:.25}}

#inputbar {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  z-index:10;
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px 16px;
  background:var(--card);
  border-top:1px solid #e5e7eb;
  box-shadow:0 -4px 12px var(--shadow);
}
.input-row{display:flex;width:100%;gap:8px;align-items:center;}
#txt{
  flex:1;
  border-radius:999px;
  padding:12px 16px;
  border:1px solid #e5e7eb;
  font-size:15px;
  outline:none;
  transition:all .2s ease;
}
#txt:focus{box-shadow:0 4px 12px var(--shadow);border-color:var(--accent);}
#send{
  background:var(--accent);
  color:#fff;
  border:none;
  padding:12px 16px;
  border-radius:999px;
  cursor:pointer;
  font-size:15px;
  display:none;
}
#send:active{transform:translateY(1px);}

.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
.chip{
  background:var(--bot);
  color:var(--accent);
  padding:6px 12px;
  border-radius:999px;
  cursor:pointer;
  font-size:13px;
  border:1px solid rgba(99,102,241,0.2);
  transition:all .2s ease;
}
.chip:hover{
  background:var(--accent);
  color:#fff;
  transform:translateY(-2px);
  box-shadow:0 6px 14px rgba(99,102,241,0.1);
}

.card{
  background:var(--card);
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:12px;
  margin-top:8px;
  box-shadow:0 2px 8px var(--shadow);
}
.card img{max-width:100%;border-radius:8px;margin-bottom:6px;}
.card a{color:var(--accent);text-decoration:none;font-weight:600;}

@media(max-width:520px){
  .bubble{max-width:92%;}
  #txt{font-size:14px;}
}

</style>
</head>
<body>

<div id="titlebar"><div><i class="fa-solid fa-robot"></i> Hybrid Assist</div></div>

<div class="wrap">
  <div id="chat-area" aria-live="polite"></div>

  <div id="inputbar">
    <div class="input-row">
      <input id="txt" placeholder="Ask me anything (knowledge, apps, images...)">
      <button id="send"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>
</div>
<script>
const chatArea=document.getElementById('chat-area');
const txt=document.getElementById('txt');
const send=document.getElementById('send');

/* ========== Chat UI helpers ========== */
function appendUser(text){
  const el=document.createElement('div');
  el.className='bubble user';
  el.textContent=text.trim();
  chatArea.appendChild(el);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function appendBotBubble(){
  const el=document.createElement('div');
  el.className='bubble bot';
  chatArea.appendChild(el);
  chatArea.scrollTop=chatArea.scrollHeight;
  return el;
}

function appendTyping(){
  const el=document.createElement('div');
  el.className='bubble bot';
  el.id='typingBubble';
  el.innerHTML='<div style="display:flex;align-items:center;gap:10px;"><div class="typing"><span></span><span></span><span></span></div><div style="color:var(--muted);">Thinking...</div></div>';
  chatArea.appendChild(el);
  chatArea.scrollTop=chatArea.scrollHeight;
  return el;
}

function removeTyping(){const t=document.getElementById('typingBubble');if(t)t.remove();}

async function typeWriter(el,html,speed=8){
  return new Promise(resolve=>{
    let i=0;
    const words=html.split(/(\s+)/);
    el.innerHTML='';
    const cursor='<span style="border-right:2px solid #4f46e5;opacity:.6"></span>';
    const timer=setInterval(()=>{
      el.innerHTML=words.slice(0,i).join('')+cursor;
      chatArea.scrollTop=chatArea.scrollHeight;
      i++;
      if(i>words.length){
        clearInterval(timer);
        el.innerHTML=html;
        resolve();
      }
    },speed);
  });
}

function escapeHtml(s){return(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
function escapeAttr(s){return(s||'').replace(/"/g,'&quot;');}

/* ========== NLP Utilities ========== */
function normalizeForSearch(q){
  q=q.trim();
  const patterns=[/^who (is|was)\s+/i,/^what (is|are|was)\s+/i,/^tell me about\s+/i,/^define\s+/i,/^explain\s+/i];
  for(const p of patterns) q=q.replace(p,'');
  return q.replace(/^[^\w]+|[^\w]+$/g,'').trim()||q;
}

function smoothText(text){
  if(!text) return "";
  text=text.replace(/\s+/g,' ').trim();

  // Capitalize start of sentences
  text=text.replace(/([.!?]\s+)([a-z])/g,(m,p1,p2)=>p1+p2.toUpperCase());
  if(text.length>1) text=text[0].toUpperCase()+text.slice(1);

  // Improve flow and readability
  text=text
    .replace(/\bfor example\b/gi,'for instance')
    .replace(/\betc\.\b/gi,'and so on')
    .replace(/\btherefore\b/gi,'as a result')
    .replace(/\bthus\b/gi,'as a result')
    .replace(/\bhowever\b/gi,'but')
    .replace(/\bthis was\b/gi,'This was')
    .replace(/\b([Ii]t|[Tt]hey) (is|are) said\b/g,'It is often described')
    .replace(/\bwas\b/g,'was known as')
    .replace(/\bare\b/g,'are generally regarded as');
  return text;
}

/* ========== Wikipedia Fetching ========== */
async function fetchWikiSummary(title){
  const url=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
  const res=await fetch(url);
  const j=await res.json();
  if(j.extract){
    let extract=j.extract;
    if(extract.length>1000) extract=extract.split(/(?<=[.!?])\s+/).slice(0,5).join(' ');
    return {title:j.title,summary:smoothText(extract),image:j.thumbnail?.source||null};
  }
  return null;
}

async function fetchMultiTopics(raw){
  // Detect multiple entities
  const topics=raw.split(/\band\b|,|\/|\+|vs\.?/i).map(t=>normalizeForSearch(t)).filter(Boolean);
  if(topics.length===0) return [];

  const results=[];
  for(const topic of topics){
    const url=`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(topic)}&srlimit=1&utf8=&format=json&origin=*`;
    const res=await fetch(url);
    const j=await res.json();
    const top=j.query?.search?.[0];
    if(!top) continue;
    const data=await fetchWikiSummary(top.title);
    if(data) results.push(data);
  }
  return results;
}

/* ========== Fact expansion (More natural) ========== */
async function handleQuery(raw){
  if(!raw?.trim()) return;
  appendUser(raw);
  const typing=appendTyping();

  try{
    const text=raw.toLowerCase();

    // If multiple subjects are requested
    if(/\band\b|,|\/|\+|vs\.?/i.test(text)){
      const results=await fetchMultiTopics(raw);
      removeTyping();
      const bubble=appendBotBubble();

      if(results.length===0){
        bubble.textContent="I couldn’t find enough reliable information for that.";
        return;
      }

      let html=`<div style="font-weight:600;margin-bottom:8px;">Here’s what I found:</div>`;
      for(const r of results){
        html+=`
        <div style="margin-bottom:14px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb;">
          <div style="font-weight:600;margin-bottom:4px;">${escapeHtml(r.title)}</div>
          ${r.image?`<img src="${r.image}" style="max-width:100%;border-radius:8px;margin:6px 0;">`:""}
          <div style="white-space:pre-wrap;">${escapeHtml(r.summary)}</div>
        </div>`;
      }
      await typeWriter(bubble,html,10);
      return;
    }

    // Single subject (summary)
    const query=normalizeForSearch(raw);
    const url=`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&srlimit=1&utf8=&format=json&origin=*`;
    const res=await fetch(url);
    const j=await res.json();
    const top=j.query?.search?.[0];
    removeTyping();

    if(!top){
      appendBotBubble().textContent="Sorry, I couldn’t find anything relevant.";
      return;
    }

    const data=await fetchWikiSummary(top.title);
    const bubble=appendBotBubble();
    if(!data){bubble.textContent="No summary found.";return;}

    let html=`<div style="font-weight:600;margin-bottom:6px;">${escapeHtml(data.title)}</div>`;
    if(data.image) html+=`<img src="${data.image}" style="max-width:100%;border-radius:8px;margin-bottom:6px;">`;
    html+=`<div style="white-space:pre-wrap;">${escapeHtml(data.summary)}</div>`;
    await typeWriter(bubble,html,10);

  }catch(err){
    removeTyping();
    appendBotBubble().textContent="Something went wrong while fetching that info.";
    console.error(err);
  }
}

/* ========== UI Events ========== */
async function onSend(){
  const v=txt.value.trim();
  if(!v) return;
  txt.value='';
  send.style.display="none";
  await handleQuery(v);
}
send.addEventListener('click',onSend);
txt.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();onSend();}
});
txt.addEventListener('input',()=>{
  send.style.display=txt.value.trim()?"inline-block":"none";
});

function clearChat(){chatArea.innerHTML='';}
window.addEventListener('beforeunload',clearChat);

/* ========== Greeting ========== */
(function greet(){
  const welcome=`<div style="font-weight:700;margin-bottom:6px;">Hello, I’m Hybrid Assistant 🤖</div>
  <div style="color:var(--muted)">Ask me naturally about people, wars, science, or world history — even combine topics. I’ll give you clear, factual summaries from open sources.</div>
  <div class="chips" style="margin-top:10px;">
    <div class="chip" data-q="World War I and World War II">Compare World War I and World War II</div>
    <div class="chip" data-q="Industrial Revolution">Tell me about the Industrial Revolution</div>
    <div class="chip" data-q="Einstein and Newton">Compare Einstein and Newton</div>
  </div>`;
  const b=appendBotBubble();
  typeWriter(b,welcome,20).then(()=>{
    b.querySelectorAll('.chip').forEach(c=>c.addEventListener('click',()=>{
      txt.value=c.getAttribute('data-q');
      onSend();
    }));
  });
})();
</script>


</body>
</html>


