<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hybrid Assit</title>
<link rel="icon" type="image/png" href="hybrid.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --accent:#6366f1;
  --accent-hover:#4f46e5;
  --bg:#f9fafb;
  --card:#ffffff;
  --muted:#6b7280;
  --text:#111827;
  --shadow:rgba(0,0,0,0.06);
  --bot:#f3f4f6;
  --user:#eef2ff;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,sans-serif;}
body{height:100vh;background:var(--bg);color:var(--text);display:flex;flex-direction:column;}

#titlebar {
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;
  background:var(--accent);
  color:#fff;
  font-weight:600;
  font-size:16px;
  position:fixed;top:0;left:0;width:100%;z-index:10;
  border-bottom:1px solid rgba(255,255,255,0.2);
}
#titlebar i{margin-right:8px;}

.wrap {
  display:flex;flex-direction:column;
  flex:1;
  padding-top:60px;   /* header height */
  padding-bottom:90px; /* input bar height */
  overflow:hidden;
}

#chat-area {
  flex:1;
  overflow-y:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
  scroll-behavior:smooth;
}

.bubble{
  max-width:80%;
  padding:14px 16px;
  border-radius:16px;
  line-height:1.5;
  font-size:14px;
  word-break:break-word;
  white-space:pre-wrap;
  box-shadow:0 4px 12px var(--shadow);
  animation:fadeIn .2s ease-out;
}
.user{
  margin-left:auto;
  background:var(--user);
  color:var(--text);
  border-bottom-right-radius:4px;
}
.bot{
  margin-right:auto;
  background:var(--bot);
  color:var(--text);
  border-bottom-left-radius:4px;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(6px);}
  to{opacity:1;transform:none;}
}

.typing{display:inline-block;width:46px;height:14px;position:relative;}
.typing span{position:absolute;width:8px;height:8px;background:var(--accent);border-radius:50%;animation:blink 1s infinite;bottom:0;}
.typing span:nth-child(2){left:12px;animation-delay:.12s;}
.typing span:nth-child(3){left:24px;animation-delay:.24s;}
@keyframes blink{0%{transform:translateY(0);opacity:.25}50%{transform:translateY(-6px);opacity:1}100%{transform:translateY(0);opacity:.25}}

#inputbar {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  z-index:10;
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px 16px;
  background:var(--card);
  border-top:1px solid #e5e7eb;
  box-shadow:0 -4px 12px var(--shadow);
}
.input-row{display:flex;width:100%;gap:8px;align-items:center;}
#txt{
  flex:1;
  border-radius:999px;
  padding:12px 16px;
  border:1px solid #e5e7eb;
  font-size:15px;
  outline:none;
  transition:all .2s ease;
}
#txt:focus{box-shadow:0 4px 12px var(--shadow);border-color:var(--accent);}
#send{
  background:var(--accent);
  color:#fff;
  border:none;
  padding:12px 16px;
  border-radius:999px;
  cursor:pointer;
  font-size:15px;
  display:none;
}
#send:active{transform:translateY(1px);}

.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
.chip{
  background:var(--bot);
  color:var(--accent);
  padding:6px 12px;
  border-radius:999px;
  cursor:pointer;
  font-size:13px;
  border:1px solid rgba(99,102,241,0.2);
  transition:all .2s ease;
}
.chip:hover{
  background:var(--accent);
  color:#fff;
  transform:translateY(-2px);
  box-shadow:0 6px 14px rgba(99,102,241,0.1);
}

.card{
  background:var(--card);
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:12px;
  margin-top:8px;
  box-shadow:0 2px 8px var(--shadow);
}
.card img{max-width:100%;border-radius:8px;margin-bottom:6px;}
.card a{color:var(--accent);text-decoration:none;font-weight:600;}

@media(max-width:520px){
  .bubble{max-width:92%;}
  #txt{font-size:14px;}
}

</style>
</head>
<body>

<div id="titlebar"><div><i class="fa-solid fa-robot"></i> Hybrid Assist</div></div>

<div class="wrap">
  <div id="chat-area" aria-live="polite"></div>

  <div id="inputbar">
    <div class="input-row">
      <input id="txt" placeholder="Ask me anything (knowledge, apps, images...)">
      <button id="send"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>
</div>
<script>
const chatArea=document.getElementById('chat-area');
const txt=document.getElementById('txt');
const send=document.getElementById('send');

function appendUser(text){
  const el=document.createElement('div');
  el.className='bubble user';
  el.textContent=text.trim();
  chatArea.appendChild(el);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function appendBotBubble(){
  const el=document.createElement('div');
  el.className='bubble bot';
  chatArea.appendChild(el);
  chatArea.scrollTop=chatArea.scrollHeight;
  return el;
}

function appendTyping(){
  const el=document.createElement('div');
  el.className='bubble bot';
  el.id='typingBubble';
  el.innerHTML='<div style="display:flex;align-items:center;gap:10px;"><div class="typing"><span></span><span></span><span></span></div><div style="color:var(--muted);">Thinking...</div></div>';
  chatArea.appendChild(el);
  chatArea.scrollTop=chatArea.scrollHeight;
  return el;
}
function removeTyping(){const t=document.getElementById('typingBubble');if(t)t.remove();}

async function typeWriter(el,html,speed=5){
  return new Promise(resolve=>{
    let i=0;
    const words=html.split(/(\s+)/);
    el.innerHTML='';
    const cursor='<span style="border-right:2px solid #4f46e5;opacity:.6"></span>';
    const timer=setInterval(()=>{
      el.innerHTML=words.slice(0,i).join('')+cursor;
      chatArea.scrollTop=chatArea.scrollHeight;
      i++;
      if(i>words.length){
        clearInterval(timer);
        el.innerHTML=html;
        resolve();
      }
    },speed);
  });
}

function escapeHtml(s){return(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
function escapeAttr(s){return(s||'').replace(/"/g,'&quot;');}

function normalizeForSearch(q){
  q=q.trim();
  const patterns=[/^who (is|was)\s+/i,/^what (is|are|was)\s+/i,/^tell me about\s+/i,/^define\s+/i,/^explain\s+/i];
  for(const p of patterns) q=q.replace(p,'');
  return q.replace(/^[^\w]+|[^\w]+$/g,'').trim()||q;
}

function smoothText(text){
  if(!text) return "";
  text=text.replace(/\s+/g,' ').trim();
  text=text.replace(/([.!?]\s+)([a-z])/g,(m,p1,p2)=>p1+p2.toUpperCase());
  if(text.length>1) text=text[0].toUpperCase()+text.slice(1);
  text=text.replace(/\bfor example\b/gi,'for instance')
           .replace(/\bhowever\b/gi,'but')
           .replace(/\btherefore\b/gi,'as a result')
           .replace(/\bthus\b/gi,'as a result')
           .replace(/\betc\.\b/gi,'and so on')
           .replace(/\be\.g\.\b/gi,'for instance');
  return text;
}

async function fetchWikiSummary(query){
  const url=`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&srlimit=3&utf8=&format=json&origin=*`;
  const res=await fetch(url);
  const j=await res.json();
  const results=j.query?.search||[];
  if(!results.length) return [];
  const summaries=[];
  for(const r of results.slice(0,2)){
    const title=r.title;
    const sumUrl=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
    const s=await fetch(sumUrl).then(r=>r.json());
    let text=s.extract||'';
    let img=s.thumbnail?.source||null;
    if(text.length>600) text=text.split(/(?<=[.!?])\s+/).slice(0,5).join(' ');
    summaries.push({title,summary:smoothText(text),image:img});
  }
  return summaries;
}

function extractTopics(input){
  const parts=input.split(/\band\b|,|plus/i).map(s=>normalizeForSearch(s)).filter(Boolean);
  return parts.slice(0,3);
}

async function handleQuery(raw){
  if(!raw?.trim()) return;
  appendUser(raw);
  const typing=appendTyping();

  try{
    if(/image|photo|picture/i.test(raw)){
      removeTyping();
      const bubble=appendBotBubble();
      bubble.innerHTML="üîç You can type for example: <b>'Show me photos of the Great Wall of China'</b> to get image results.";
      return;
    }

    const topics=extractTopics(raw);
    const allSummaries=[];
    for(const topic of topics){
      const results=await fetchWikiSummary(topic);
      allSummaries.push(...results);
    }

    removeTyping();
    const bubble=appendBotBubble();

    if(!allSummaries.length){
      bubble.innerHTML="I couldn‚Äôt find much on that topic. Try rephrasing or asking something broader.";
      return;
    }

    let response="";
    if(allSummaries.length===1){
      const s=allSummaries[0];
      response+=`<div style="font-weight:600;margin-bottom:6px;">${escapeHtml(s.title)}</div>`;
      if(s.image) response+=`<img src="${s.image}" style="max-width:100%;border-radius:8px;margin-bottom:8px;">`;
      response+=`<div>${escapeHtml(s.summary)}</div>`;
    } else {
      response+="<div style='font-weight:600;margin-bottom:6px;'>Here‚Äôs what I found on those topics:</div>";
      for(const s of allSummaries){
        response+=`<div style="margin-top:8px;border-top:1px solid #e5e7eb;padding-top:8px;">
          <div style="font-weight:600;margin-bottom:4px;">${escapeHtml(s.title)}</div>
          ${s.image?`<img src="${s.image}" style="max-width:100%;border-radius:8px;margin-bottom:6px;">`:''}
          <div style="color:#374151;">${escapeHtml(s.summary)}</div>
        </div>`;
      }
      response+="<div style='margin-top:10px;color:var(--muted)'>I combined information from multiple related sources to keep it clear and natural.</div>";
    }

    await typeWriter(bubble,response,10);

  }catch(err){
    console.error(err);
    removeTyping();
    appendBotBubble().innerHTML="Sorry, there was an error while fetching that.";
  }
}

async function onSend(){
  const v=txt.value.trim();
  if(!v) return;
  txt.value='';
  send.style.display='none';
  await handleQuery(v);
}

send.addEventListener('click',onSend);
txt.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();onSend();}
});
txt.addEventListener('input',()=>{send.style.display=txt.value.trim()?'inline-block':'none';});
window.addEventListener('beforeunload',()=>chatArea.innerHTML='');

(function greet(){
  const welcome=`<div style="font-weight:700;margin-bottom:6px;">Hi ‚Äî I‚Äôm your Natural Knowledge Assistant üåç</div>
  <div style="color:var(--muted)">Ask me naturally, like you‚Äôd talk to a person. I can explain facts, summarize topics, or combine multiple ideas for you.</div>
  <div class="chips" style="margin-top:10px;">
    <div class="chip" data-q="Einstein and Newton">Compare Einstein and Newton</div>
    <div class="chip" data-q="Causes of World War 1">What caused World War 1?</div>
    <div class="chip" data-q="Photosynthesis and Cellular Respiration">Explain Photosynthesis and Cellular Respiration</div>
  </div>`;
  const b=appendBotBubble();
  typeWriter(b,welcome,20).then(()=>{
    b.querySelectorAll('.chip').forEach(c=>{
      c.addEventListener('click',()=>{txt.value=c.getAttribute('data-q');onSend();});
    });
  });
})();
</script>

</body>
</html>

