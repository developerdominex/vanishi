<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Register â€” Hybrid Chat</title>
<link rel="icon" type="image/png" href="hybrid.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://apis.google.com/js/api.js"></script>

<style>
:root {
  --accent:#6366f1;
  --accent-hover:#4f46e5;
  --bg:#e8ebf3;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --shadow:rgba(0,0,0,0.1);
}

/* Reset */
* { box-sizing:border-box; margin:0; padding:0; font-family: "Inter", sans-serif; }

/* Body & Background */
body {
  height:100vh;
  background:var(--bg);
  overflow:hidden;
  position:relative;
}

/* Floating bubbles */
.bubble {
  position:absolute;
  border-radius:50%;
  background:var(--accent);
  opacity:0.12;
  animation:float 8s ease-in-out infinite;
}
.bubble:nth-child(1){width:120px;height:120px;top:10%;left:5%;animation-delay:0s;}
.bubble:nth-child(2){width:80px;height:80px;bottom:15%;right:10%;animation-delay:2s;}
.bubble:nth-child(3){width:60px;height:60px;top:40%;left:70%;animation-delay:1s;}
@keyframes float {0%,100%{transform:translateY(0);}50%{transform:translateY(-25px);}}

/* Main Panel */
.reg-card {
  background: var(--card);
  padding: 30px 28px;
  border-radius: 18px;
  width: 400px;
  max-width: 95%;
  position:absolute;
  top:50px;
  left:50px;
  box-shadow:0 16px 36px var(--shadow);
  display:flex;
  flex-direction:column;
  gap:12px;
  transform: translateZ(0);
}

/* Header */
.reg-card h2{font-size:24px;font-weight:700;color:var(--text);}
p.sub{font-size:14px;color:var(--muted);margin-bottom:16px;}

/* User Info */
#userInfo {
  display:flex;
  align-items:center;
  gap:12px;
  padding:8px;
  border-radius:12px;
  background:#f9f9f9;
  opacity:0;
  transform:translateX(-30px);
  transition:all 0.6s ease;
}
#userInfo.show {opacity:1; transform:translateX(0);}
#userInfo img {width:60px;height:60px;border-radius:50%;box-shadow:0 4px 12px var(--shadow);}
#userInfo h3{font-size:16px;color:var(--text);font-weight:600;}

/* Mini File Explorer */
#miniExplorer {
  position:absolute;
  top:220px;
  left:50px;
  width:320px;
  background:var(--card);
  border-radius:14px;
  box-shadow:0 12px 36px var(--shadow);
  overflow:hidden;
  opacity:0;
  animation:slideIn 1s ease forwards;
  transform:translateY(-30px);
}
@keyframes slideIn {to{opacity:1; transform:translateY(0);}}
#miniExplorer .header {
  background:var(--accent);
  color:#fff;
  padding:10px 14px;
  display:flex;align-items:center;gap:6px;font-size:14px;
}
#miniExplorer .content {
  padding:10px;
  max-height:150px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.file-row {
  display:flex; align-items:center; gap:8px; font-size:13px; color:var(--text);
  opacity:0; transform:translateX(-20px);
  animation:rowSlide 0.5s forwards;
}
.file-row i{color:var(--accent);}
@keyframes rowSlide {to{opacity:1; transform:translateX(0);}}

/* Google Sign-In Button Wrapper */
#buttonDiv {margin-top:12px; display:flex; justify-content:flex-start;}

/* Loading Overlay */
#loadingOverlay {
  position:fixed; inset:0; background:rgba(255,255,255,0.9);
  display:none; align-items:center; justify-content:center; flex-direction:column; z-index:100;
}
#loadingOverlay i{font-size:48px; color:var(--accent); animation:float 2s infinite;}
#loadingOverlay p{margin-top:12px; font-size:14px; color:var(--muted);}
</style>
</head>
<body>

<!-- Floating Bubbles -->
<div class="bubble"></div>
<div class="bubble"></div>
<div class="bubble"></div>

<!-- Mini File Explorer -->
<div id="miniExplorer">
  <div class="header"><i class="fas fa-folder-open"></i> My Drive</div>
  <div class="content" id="explorerContent"></div>
</div>

<!-- Main Card -->
<div class="reg-card">
  <h2>Hybrid Chat</h2>
  <p class="sub">Sign in with Google to continue</p>
  <div id="buttonDiv"></div>
  <div id="userInfo">
    <img id="userPic" alt="Profile">
    <h3 id="userName"></h3>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay">
  <i class="fab fa-google-drive"></i>
  <p>Syncing your Drive account...</p>
</div>

<script>
// Mini Explorer Animation
const explorerContent=document.getElementById('explorerContent');
const exampleFiles=[
  {icon:"fa-folder",name:"Projects"},
  {icon:"fa-folder",name:"Hybrid Chat"},
  {icon:"fa-file-code",name:"main.js"},
  {icon:"fa-file-image",name:"avatar.png"},
  {icon:"fa-file-lines",name:"account.json"}
];
let i=0;
function addNextFile(){
  if(i>=exampleFiles.length)return;
  const f=exampleFiles[i];
  const el=document.createElement('div');
  el.className='file-row';
  el.style.animationDelay=`${i*0.3}s`;
  el.innerHTML=`<i class="fas ${f.icon}"></i><span>${f.name}</span>`;
  explorerContent.appendChild(el);
  i++;
  setTimeout(addNextFile,350);
}
addNextFile();

// Google Sign-In
let tokenClient;
const CLIENT_ID="549003131640-o9umsg7tu0uisopde76mlf3lg5krt5g7.apps.googleusercontent.com";
const SCOPES="https://www.googleapis.com/auth/drive.file";

window.onload = () => {
  google.accounts.id.initialize({client_id:CLIENT_ID, callback:handleCredentialResponse});
  google.accounts.id.renderButton(document.getElementById("buttonDiv"),
    { theme: "filled_blue", size: "large", text: "signin_with", shape: "rectangular" });
}

// Handle Sign-In
async function handleCredentialResponse(response){
  const data=JSON.parse(atob(response.credential.split('.')[1]));

  // Display profile
  const userInfo=document.getElementById('userInfo');
  document.getElementById('userPic').src=data.picture;
  document.getElementById('userName').textContent=data.name;
  userInfo.classList.add('show');

  // Save locally
  const profileData={
    uuid:crypto.randomUUID(),
    name:data.name,
    email:data.email,
    avatar:data.picture,
    createdAt:new Date().toISOString()
  };
  localStorage.setItem('rc_profile_v2', JSON.stringify(profileData));

  // Show loading overlay
  const overlay=document.getElementById('loadingOverlay');
  overlay.style.display='flex';

  // Upload account.json to Drive
  gapi.load('client', async () => {
    await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]});
    tokenClient=google.accounts.oauth2.initTokenClient({
      client_id:CLIENT_ID,
      scope:SCOPES,
      callback: async (tokenResponse)=>{
        if(tokenResponse.error){console.error(tokenResponse);return;}
        const accessToken=tokenResponse.access_token;
        const metadata={name:"account.json",mimeType:"application/json"};
        const form=new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)],{type:'application/json'}));
        form.append('file', new Blob([JSON.stringify(profileData)],{type:'application/json'}));
        await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',{
          method:'POST',
          headers:{'Authorization':'Bearer '+accessToken},
          body:form
        });
        // Redirect after small delay
        setTimeout(()=>window.location.href='index.html',1200);
      }
    });
    tokenClient.requestAccessToken({prompt:'consent'});
  });
}

// Disable right-click & devtools
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{
  if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&['I','J','C'].includes(e.key.toUpperCase()))||(e.ctrlKey&&['U','S','P'].includes(e.key.toUpperCase()))){
    e.preventDefault(); e.stopPropagation();
  }
});
</script>
</body>
</html>
